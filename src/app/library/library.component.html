<app-delete-task-template *ngIf="showDeleteTaskTemplateComponent" (close)="closeTaskTemplateDialog()" (delete)="deleteTaskTemplate()" [model]="selectedTemplate"></app-delete-task-template>
<div id="library" class="view">
  <div class="view__header"><a routerLink="/dashboard" class="view__header-link type--back"></a>
    <h1 class="view__header-title">Tehtäväkirjasto</h1>
  </div>
  <div class="view__content">
    <div class="view__columns">
      <div class="view__column type--one">
        <div class="view__filters">
          <div class="view__filter">
            <div (click)="toggleFilter('creator')" class="view__filter-dropdown" [ngClass]="isFilterOpen('creator') ? 'is-open' : ''">
              <div class="view__filter-dropdown-title">Tekijä: {{ cFilter.creator }}</div>
              <div class="view__filter-dropdown-handle"></div>
              <div class="view__filter-dropdown-content">
                <div (click)="filter('creator', 'Kaikki')" class="view__filter-dropdown-row" [ngClass]="cFilter.creator === 'Kaikki' ? 'is-selected' : ''">Kaikki</div>
                <div (click)="filter('creator', 'Minä')" class="view__filter-dropdown-row" [ngClass]="cFilter.creator === 'Minä' ? 'is-selected' : ''">Minä</div>
              </div>
            </div>
          </div>
          <div class="view__filter">
            <div (click)="toggleFilter('type')" class="view__filter-dropdown" [ngClass]="isFilterOpen('type') ? 'is-open' : ''">
              <div class="view__filter-dropdown-title">Tyyppi: {{ cFilter.type }}</div>
              <div class="view__filter-dropdown-handle"></div>
              <div class="view__filter-dropdown-content">
                <div (click)="filter('type', 'Kaikki')" class="view__filter-dropdown-row" [ngClass]="cFilter.type === 'Kaikki' ? 'is-selected' : ''">Kaikki</div>
                <div (click)="filter('type', 'Tutki')" class="view__filter-dropdown-row" [ngClass]="cFilter.type === 'Tutki' ? 'is-selected' : ''">Tutki</div>
                <div (click)="filter('type', 'Toimi')" class="view__filter-dropdown-row" [ngClass]="cFilter.type === 'Toimi' ? 'is-selected' : ''">Toimi</div>
                <div (click)="filter('type', 'Pähkinä')" class="view__filter-dropdown-row" [ngClass]="cFilter.type === 'Pähkinä' ? 'is-selected' : ''">Pähkinä</div>
              </div>
            </div>
          </div>
        </div>
      <div class="list type--library">
        <!--<div class="list__item" *ngIf="role === 'student'">
          <div class="list__item-content">
            <div class="list__item-title">Karttaesitys</div>
            <div class="list__item-description">Kartta ja työkalut oman esityksen luomiseen.</div>
          </div>
          <div class="list__item-footer">
            <a routerLink="/own-task-template" class="list__item-link">Aloita tehtävä</a>
          </div>
        </div>-->
        <div class="list__item" *ngIf="role === 'teacher'">
          <div class="list__item-content">
            <div class="list__item-title">Uusi tehtäväpohja</div>
            <div class="list__item-description">Rakenna oma tehtäväpohja.</div>
          </div>
          <div class="list__item-footer">
            <a routerLink="/task-template" class="list__item-link">Uusi tehtäväpohja</a>
          </div>
        </div>
        <div class="list__item" *ngFor="let t of taskTemplates; let i = index">
          <div *ngIf="isCreator(t)" (click)="toggleDropdown(i)" class="list__item-dropdown" [ngClass]="isDropdownOpen(i) ? 'is-open' : ''">
            <div class="list__item-dropdown-handle"></div>
            <div class="list__item-dropdown-content">
              <div class="list__item-dropdown-row" [routerLink]="['/task-template', t.id]">Muokkaa</div>
              <div class="list__item-dropdown-row" (click)="showDeleteTaskTemplateDialog(t.id)">Poista</div>
            </div>
          </div>
          <div class="list__item-type {{getTaskTypeClass(t.type)}}"></div>
          <div class="list__item-content">
            <div class="list__item-title">{{t.name}}</div>
            <div class="list__item-description">{{t.description}}</div>
          </div>
          <div class="list__item-info" *ngIf="role === 'teacher'">
            <div class="list__item-tag" *ngIf="t.ops != null">
              <div class="tag" *ngFor="let grade of t.ops.grades">{{grade.name}}</div><div
                class="tag" *ngFor="let subject of t.ops.subjects">{{subject.name}}</div><div
                class="tag" *ngFor="let target of t.ops.targets" title="{{target.name}}">{{target.name | limitTo: 35 }}</div><div
                class="tag" *ngFor="let contentArea of t.ops.contentAreas" title="{{contentArea.name}}">{{contentArea.name | limitTo: 35}}</div><div
                class="tag" *ngFor="let wideKnowledge of t.ops.wideKnowledges" title="{{wideKnowledge.name}}">{{wideKnowledge.name | limitTo: 35}}</div>
            </div>
          </div>
          <div class="list__item-footer">
            <a (click)="createTask(t.id)" class="list__item-link">Aloita tehtävä</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="popup" *ngIf="selectedTemplateForTask">
  <div class="popup__content">
    <form (ngSubmit)="onSubmit()" #taskForm="ngForm">
      <div class="popup__scroll">
        <div class="form type--basic">
          <h1 class="accordion__header">{{selectedTemplateForTask.name}}</h1>
          <div class="form__item" [class.has-error]="name.invalid && name.dirty">
            <label>Nimi</label>
            <input type="text" maxlength="128" required [(ngModel)]="model.name" name="name" #name="ngModel">
            <div [hidden]="name.valid || name.pristine" class="form__item-error alert alert-danger"><div class="text">Pakollinen tieto</div></div>
          </div>
        </div>
      </div>
      <div class="popup__footer">
        <div class="popup__footer-links">
          <a (click)="closePopup()" class="link type--secondary">Peruuta</a>
          <button type="submit" class="link" [disabled]="!taskForm.form.valid">Tallenna</button>
        </div>
      </div>
    </form>
  </div>
</div>