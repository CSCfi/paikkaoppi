<app-delete-task-template *ngIf="showDeleteTaskTemplateComponent" (close)="closeTaskTemplateDialog()" (delete)="deleteTaskTemplate()" [model]="selectedTemplate"></app-delete-task-template>
<div id="library" class="view">
  <div class="view__header"><a routerLink="/dashboard" class="view__header-link type--back"></a>
    <h1 class="view__header-title">Tehtäväkirjasto</h1>
  </div>
  <div class="view__content">
    <div class="view__columns">
      <div class="view__column type--one">
        <div class="view__filters">
          <div class="view__filter">
            <div class="view__filter-dropdown is-open">
              <div class="view__filter-dropdown-title">Tekijä: Minä</div>
              <div class="view__filter-dropdown-handle"></div>
              <div class="view__filter-dropdown-content">
                <div class="view__filter-dropdown-row is-selected">Minä</div>
                <div class="view__filter-dropdown-row">Oili Opettaja</div>
              </div>
            </div>
          </div>
          <div class="view__filter">
            <div class="view__filter-dropdown">
              <div class="view__filter-dropdown-title">Tyyppi</div>
              <div class="view__filter-dropdown-handle"></div>
              <div class="view__filter-dropdown-content">
                <div class="view__filter-dropdown-row">Toimi</div>
                <div class="view__filter-dropdown-row">Tutki</div>
                <div class="view__filter-dropdown-row">Tee</div>
              </div>
            </div>
          </div>
        </div>
      <div class="list type--library">
        <!--<div class="list__item" *ngIf="role === 'student'">
          <div class="list__item-content">
            <div class="list__item-title">Karttaesitys</div>
            <div class="list__item-description">Kartta ja työkalut oman esityksen luomiseen.</div>
          </div>
          <div class="list__item-footer">
            <a routerLink="/own-task-template" class="list__item-link">Aloita tehtävä</a>
          </div>
        </div>-->
        <div class="list__item" *ngIf="role === 'teacher'">
          <div class="list__item-content">
            <div class="list__item-title">Uusi tehtäväpohja</div>
            <div class="list__item-description">Rakenna oma tehtäväpohja.</div>
          </div>
          <div class="list__item-footer">
            <a routerLink="/task-template" class="list__item-link">Uusi tehtäväpohja</a>
          </div>
        </div>
        <div class="list__item" *ngFor="let t of taskTemplates">
          <div class="list__item-type {{getTaskTypeClass(t.type)}}"></div>
          <div class="list__item-content">
            <div class="list__item-title">{{t.name}}</div>
            <div class="list__item-description">{{t.description}}</div>
          </div>
          <div class="list__item-info" *ngIf="role === 'teacher'">
            <div class="list__item-tag" *ngIf="t.ops != null">
              <div class="tag" *ngFor="let grade of t.ops.grades">{{grade.name}}</div>
              <div class="tag" *ngFor="let subject of t.ops.subjects">{{subject.name}}</div>
              <div class="tag" *ngFor="let target of t.ops.targets" title="{{target.name}}">{{target.name | limitTo: 35 }}</div>
              <div class="tag" *ngFor="let contentArea of t.ops.contentAreas" title="{{contentArea.name}}">{{contentArea.name | limitTo: 35}}</div>
              <div class="tag" *ngFor="let wideKnowledge of t.ops.wideKnowledges" title="{{wideKnowledge.name}}">{{wideKnowledge.name | limitTo: 35}}</div>
            </div>
          </div>
          <div class="list__item-footer">
            <a *ngIf="isCreator(t)" (click)="showDeleteTaskTemplateDialog(t.id)" class="list__item-link">Poista tehtäväpohja</a>
            <a *ngIf="isCreator(t)" [routerLink]="['/task-template', t.id]" class="list__item-link">Muokkaa tehtäväpohjaa</a>
            <a (click)="createTask(t.id)" class="list__item-link">Aloita tehtävä</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="popup" *ngIf="selectedTemplateForTask">
  <div class="popup__content">
    <form (ngSubmit)="onSubmit()" #taskForm="ngForm">
      <div class="popup__scroll">
        <div class="form type--basic">
          <h1 class="accordion__header">{{selectedTemplateForTask.name}}</h1>
          <div class="form__item" [class.has-error]="name.invalid && name.dirty">
            <label>Nimi</label>
            <input type="text" maxlength="128" required [(ngModel)]="model.name" name="name" #name="ngModel">
            <div [hidden]="name.valid || name.pristine" class="form__item-error alert alert-danger"><div class="text">Pakollinen tieto</div></div>
          </div>
        </div>
      </div>
      <div class="popup__footer">
        <div class="popup__footer-links">
          <a (click)="closePopup()" class="link type--secondary">Peruuta</a>
          <button type="submit" class="link" [disabled]="!taskForm.form.valid">Tallenna</button>
        </div>
      </div>
    </form>
  </div>
</div>