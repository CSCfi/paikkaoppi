<div class="popup" *ngIf="visible === true">
  <div class="popup__content">
    <div class="form type--basic">
      <div class="popup__header"><a (click)="close()" class="popup__header-link type--back"></a>
        <h1 class="popup__header-title" *ngIf="!isEditMode">Merkintä</h1>
        <h1 class="popup__header-title" *ngIf="isEditMode && model.isNew">Uusi merkintä</h1>
        <h1 class="popup__header-title" *ngIf="isEditMode && !model.isNew">Päivitä merkintää</h1>
      </div>
      <div class="form__text" *ngIf="showUser">
        <div class="form__text-title">Käyttäjä</div>
        <div class="form__text-value">{{result.user.firstName}} {{result.user.lastName}} {{result.user.email}}</div>
      </div>
      <div class="form__text">
        <ng-container *ngIf="isPoint">
          <div class="form__text-title">Koordinaatit ETRS-TM35FIN</div>
          <div class="form__text-value">N:{{model.geometry.coordinates[0]}} E:{{model.geometry.coordinates[1]}}</div>
          <div class="form__text-title">Koordinaatit WGS84</div>
          <div class="form__text-value">N:{{pointWGS84Coordinates.lat.asString(3)}} E:{{pointWGS84Coordinates.lon.asString(3)}}</div>
        </ng-container>
        <ng-container *ngIf="isPolygon">
          <div class="form__text-title">Koordinaatit ETRS-TM35FIN</div>
          <div class="form__text-value">
            <ul>
              <li *ngFor="let c of polygonCoordinates">N:{{c[0]}} E:{{c[1]}}</li>
            </ul>
          </div>
          <div class="form__text-title">Koordinaatit WGS84</div>
          <div class="form__text-value">
            <ul>
              <ng-template ngFor let-c [ngForOf]="polygonWGS84Coordinates">
                <li>N:{{c.lat.asString(3)}} E:{{c.lon.asString(3)}}</li>
              </ng-template>
            </ul>
          </div>
        </ng-container>
      </div>
      <ng-container *ngIf="isEditMode">
        <div id="imageAdd" class="form__image">
          <div class="form__image-placement">
            <div *ngIf="hasImage() == true" [ngStyle]="{ 'background-image': 'url(' + imageUrl() + ')' }" class="form__image-placement-cover"></div>
            <label *ngIf="hasImage() == false" class="text" for="upload-add">
              <span>Lisää kuva</span>
              <input type="file" id="upload-add" ng2FileSelect [uploader]="uploader" accept=".png, .jpg, .gif" style="display:none"/>
            </label>
            <div *ngIf="hasImage() == true" class="form__image-placement-buttons">
              <label for="upload-change" class="text">
                <span>Vaihda kuva</span>
                <input type="file" id="upload-change" ng2FileSelect [uploader]="uploader" accept=".png, .jpg, .gif" style="display:none"/>
              </label>
              <div class="text type--remove" (click)="removeImage()">Poista kuva</div>
            </div>
          </div>
          <div *ngIf="uploader.isUploading" class="progress-bar" role="progressbar" [ngStyle]="{ 'width': uploader.progress + '%' }"></div>
          <div>{{errorMessage}}</div>
        </div>
        <form (ngSubmit)="save()" #resultItemForm="ngForm">
          <div class="form__item" [class.has-error]="name.invalid && name.dirty">
            <label>Nimi</label>
            <input type="text" required [(ngModel)]="model.name" name="name" #name="ngModel">
            <div [hidden]="name.valid || name.pristine" class="alert alert-danger">Pakollinen tieto</div>
          </div>
          <div class="form__item">
            <label>Kuvaus</label>
            <textarea [(ngModel)]="model.description" name="description"></textarea>
          </div>
          <div class="form__footer">
            <button type="submit" class="button" [disabled]="!resultItemForm.form.valid || uploader.isUploading">Tallenna merkintä</button>
            <button class="button type--secondary" [disabled]="uploader.isUploading" (click)="delete()" *ngIf="model['id'] != null">Poista merkintä</button>
            <button class="button type--secondary" [disabled]="uploader.isUploading" (click)="close()">Sulje</button>
          </div>
        </form>
      </ng-container>
      <ng-container *ngIf="!isEditMode">
        <div *ngIf="hasImage() == true" class="form__image-placement">
          <div [ngStyle]="{ 'background-image': 'url(' + imageUrl() + ')' }" class="form__image-placement-preview"></div>
        </div>
        <div class="form__item">
          <label>Nimi</label>
          <div class="form__value">{{model.name}}</div>
        </div>
        <div class="form__item">
          <label>Kuvaus</label>
          <div class="form__value">{{model.description}}</div>
        </div>
        <div class="form__footer" *ngIf="!showUser">
          <button class="button" (click)="edit()">Muokkaa merkintää</button>
          <button class="button type--secondary" (click)="close()">Sulje</button>
        </div>
        <div class="form__footer" *ngIf="showUser">
          <button class="button" (click)="close()">Sulje</button>
        </div>
      </ng-container>
    </div>
  </div>
</div>